# KubeStellar Website Documentation Management

This page provides comprehensive guidance for contributing to the KubeStellar website documentation. It covers how the website is built, how to preview changes, and how to test documentation pull requests.

## Table of Contents

- [Website Overview](#website-overview)
- [Technology Stack](#technology-stack)
- [Previewing Website Changes](#previewing-website-changes)
  - [Global Preview via GitHub](#global-preview-via-github)
  - [Local Preview](#local-preview)
- [Testing Documentation PRs](#testing-documentation-prs)
- [Website Structure and Configuration](#website-structure-and-configuration)
- [Publishing and Versioning](#publishing-and-versioning)
- [Shortcut URLs](#shortcut-urls)

## Website Overview

We have two websites:

- **`https://kubestellar.io`** - Hosted by GoDaddy and administered by [Andy Anderson](mailto://andy@clubanderson.com). Contains redirects, with `https://kubestellar.io/` redirecting to `https://docs.kubestellar.io/`.
- **`https://docs.kubestellar.io`** - GitHub Pages website based on the `github.com/kubestellar/kubestellar/` repository.

**Contributor websites**: Contributors may have their own copy of the website at `https://${repo_owner}.github.io/${fork_name}` if they have set up their fork properly to render webpages. This is useful for generating previews of changes before merging into the main branch.

## Technology Stack

Our documentation is powered by:

- **[mike](https://github.com/jimporter/mike)** and **[MkDocs](https://www.mkdocs.org/)** for multi-version documentation
- **[Python-Markdown](https://pypi.org/project/Markdown/)** for markdown processing
- **[Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)** theme
- **[awesome-pages](https://github.com/lukasgeiter/mkdocs-awesome-pages-plugin)** plugin for navigation control
- **[macros](https://mkdocs-macros-plugin.readthedocs.io/en/latest/)** plugin for templating
- **[include-markdown](https://github.com/clubanderson/mkdocs-include-markdown-plugin)** plugin for reusing content
- **[SuperFences](https://facelessuser.github.io/pymdown-extensions/extensions/superfences/)** and **[Highlight](https://facelessuser.github.io/pymdown-extensions/extensions/highlight/)** for code blocks
- **[Pygments](https://pypi.org/project/Pygments/)** for syntax highlighting
- **[mkdocs-static-i18n](https://github.com/ultrabug/mkdocs-static-i18n/tree/0.53#readme)** for multi-language support (currently English only)

### Note on Include-Markdown for "Wrapper" Files

Several website pages are generated by including files from the repository root, wrapped in short files in the docs tree via include directives. This is especially used for including REQUIRED files from the root (denoted by all-caps filenames). For ease of navigation during editing, such wrapper files should include **-inc** or **-include** in their filename to reduce confusion.

## Previewing Website Changes

You can preview website changes in two ways: globally from a fork on GitHub, or locally on your development machine.

### Global Preview via GitHub

You can create an online, shareable rendering of the website using the ["Generate and Push Docs" GitHub Actions workflow](https://github.com/kubestellar/kubestellar/blob/v{{ config.ks_latest_release }}/.github/workflows/docs-gen-and-push.yml). This is particularly useful for documentation PRs as it allows sharing previews via URL.

#### Setting Up a Fork for GitHub Actions

1. **Create a proper fork**:
   - Log into GitHub and navigate to `github.com/kubestellar/kubestellar`
   - Select the **Forks** dropdown and click the plus sign to create a new fork
   - **Important**: Uncheck "copy the `main` branch only" to include the `gh-pages` branch
   - If you already created a fork with only the main branch, propagate the `gh-pages` branch using git commands

2. **Configure GitHub Pages**:
   - Go to your fork's Settings tab
   - Select "Pages" in the left navigation
   - Configure GitHub to publish your site based on the `gh-pages` branch

#### Manual Website Generation

1. Work on documents in a branch of your fork and commit changes
2. Push changes to your fork if working locally
3. Go to the Actions tab in your fork's repository page
4. Select "Generate and Push Docs" from the left sidebar
5. Click "Run Workflow" on the right
6. Select your branch and click the second "Run Workflow" button
7. The workflow will automatically call the "Pages build and deployment" workflow
8. Monitor progress on the Actions page (green checkmark indicates success)
9. After about a minute, preview your website at `https://${repo_owner}.github.io/${fork_name}/${branch_name}`

#### Automatic Generation

Create a branch starting with **doc-** (e.g., `doc-myversion`) and the workflow will trigger automatically when you commit changes.

#### Version Switching

Each branch renders as its own version. Use the release dropdown in the rendered pages to switch between versions. Note: the **main** branch renders as `https://${repo_owner}.github.io/${fork_name}/main`, not as "unreleased-development".

#### Cleanup

You can use `mike` to remove outdated versions or replace `gh-pages` with a copy of the shared version.

### Local Preview

You can view and modify documentation in your local development environment.

#### Basic Local Setup

```shell
git clone git@github.com:{{ config.repo_short_name }}.git
cd {{ config.repo_default_file_path }}/docs
git checkout {{ config.ks_branch }}
```

#### Using Global Python Environment

```shell
pip install -r requirements.txt
mkdocs serve
```

Then open a browser to [`http://localhost:8000/`](http://localhost:8000/)

#### Using Virtual Environment (Recommended)

```shell
( cd ..; make venv )
. venv/bin/activate
mkdocs serve
```

Then open a browser to [`http://localhost:8000/`](http://localhost:8000/)

#### Using Mike for Multi-Version Local Viewing

To view all branches/versions locally using mike (reflects what's deployed to `gh-pages`):

```shell
git clone git@github.com:{{ config.repo_short_name }}.git
cd {{ config.repo_default_file_path }}
git checkout {{ config.ks_branch }}
cd docs
mike set-default {{ config.ks_branch }}
cd ..
make serve-docs
```

Then open a browser to [`http://localhost:8000/`](http://localhost:8000/)

## Testing Documentation PRs

If a contributor has **not** created a shareable preview of a documentation PR [as documented above](#global-preview-via-github), here are the steps to checkout a git pull request for local testing.

### Step 1: Checkout the Pull Request

#### 1.1 Use `git fetch` to get a local copy of the PR's branch

Fetch the reference to the pull request based on its ID number, creating a new branch locally. Replace `ID` with your PR number and `BRANCH_NAME` with your desired branch name.

```shell
git fetch upstream pull/ID/head:BRANCH_NAME
```

This assumes your local workspace has a "git remote" named "upstream" that refers to the shared repository at `github.com/kubestellar/kubestellar`.

#### 1.2 Switch to the new branch

```shell
git checkout BRANCH_NAME
```

At this point, you can run local tests or merge other branches into this branch.

### Step 2: Test and Build the Documentation

See [Local Preview](#local-preview) for how to view and modify the documentation in the branch you have checked out.

## Website Structure and Configuration

All documentation-related items live in the `docs` directory (with small exceptions for various `make` targets and helper scripts in `hack`).

### Directory Structure

| Path                        | Description                                                                       |
|-----------------------------|-----------------------------------------------------------------------------------|
| config/$language/mkdocs.yml | Language-specific `mkdocs` configuration.                                         |
| content/$language           | Language-specific website content.                                                |
| generated/branch            | All generated content for all languages for the current version.                  |
| generated/branch/$language  | Generated content for a single language. Never added to git.                      |
| generated/branch/index.html | Minimal index for the current version that redirects to the default language (en) |
| overrides                   | Global (not language-specific) content.                                           |
| Dockerfile                  | Builds the kubestellar-docs image containing mkdocs + associated tooling.                 |
| mkdocs.yml                  | Minimal `mkdocs` configuration for `mike` for multi-version support.              |
| requirements.txt            | List of Python modules used to build the site.                                    |

### Global Variables

Many global variables are defined in [docs/mkdocs.yml]({{ config.repo_raw_url }}/{{ config.ks_branch }}/docs/mkdocs.yml). Common variables you should use in documentation:

- `site_name`: {{ config.site_name }}
- `repo_url`: {{ config.repo_url }}
- `site_url`: {{ config.site_url }}
- `repo_default_file_path`: {{ config.repo_default_file_path }}
- `repo_short_name`: {{ config.repo_short_name }}
- `docs_url`: {{ config.docs_url }}
- `repo_raw_url`: {{ config.repo_raw_url }}
- `edit_uri`: {{ config.edit_uri }}
- `ks_branch`: {{ config.ks_branch }}
- `ks_tag`: {{ config.ks_tag }}
- `ks_latest_regular_release`: {{ config.ks_latest_regular_release }}
- `ks_latest_release`: {{ config.ks_latest_release }}

### Jinja Templating

Our documentation stack includes [Jinja](https://jinja.palletsprojects.com/en/3.1.x/). Jinja constructs (`{# comment #}`, `{{ expression }}`, and `{% statement %}`) can appear in markdown sources.

## Publishing and Versioning

### Supported Aliases

`mike` has a concept of aliases. We currently maintain:

- `latest` ([{{config.docs_url}}/latest](https://docs.kubestellar.io/latest)) for the latest regular release

The publishing workflow updates these aliases. The latest regular release is determined by picking the first version listed by `mike list` that matches the regexp `release-[0-9.]*`.

### Publishing from Main Branch

The "main" branch gets published as a "version" on the website with the name "unreleased-development" (not done by `mike` aliasing, which only adds versions).

## Shortcut URLs

We have several shortcut URLs for easy reference:

**Note**: You need to join our mailing list first to access some links ([{{ config.docs_url }}/joinus](https://kubestellar.io/joinus))

- [https://kubestellar.io/agenda](https://kubestellar.io/agenda) - Community meeting agenda Google Doc
- [https://kubestellar.io/blog](https://kubestellar.io/blog) - Medium reading list
- [https://kubestellar.io/code](https://kubestellar.io/code) - Current GitHub repo
- [https://kubestellar.io/community](https://kubestellar.io/community) - Stable docs community page
- [https://kubestellar.io/drive](https://kubestellar.io/drive) - Google Drive
- [https://kubestellar.io/joinus](https://kubestellar.io/joinus) - Dev mailing list signup
- [https://kubestellar.io/join_us](https://kubestellar.io/join_us) - Also dev mailing list
- [https://kubestellar.io/linkedin](https://kubestellar.io/linkedin) - LinkedIn filter/page
- [https://kubestellar.io/tv](https://kubestellar.io/tv) - YouTube channel
- [https://kubestellar.io/youtube](https://kubestellar.io/tv) - Also YouTube channel
- [https://kubestellar.io/infomercial](https://kubestellar.io/infomercial) - Infomercial
- [https://kubestellar.io/quickstart](https://kubestellar.io/quickstart) - Stable Getting Started recipe
