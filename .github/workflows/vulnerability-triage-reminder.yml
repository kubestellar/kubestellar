name: Vulnerability Report Triage Reminder

on:
  schedule:
    - cron: '0 9 * * *'  # Daily at 9 AM UTC
  workflow_dispatch:  # Allow manual trigger

permissions:
  issues: write

jobs:
  check-untriaged-vulnerabilities:
    runs-on: ubuntu-latest
    steps:
      - name: Check for untriaged vulnerability reports
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea  # v7.0.1
        with:
          script: |
            const fourteenDaysAgo = new Date(Date.now() - 14 * 24 * 60 * 60 * 1000);

            // Note: GitHub Security Advisories API requires security events permission
            // This workflow checks for publicly reported vulnerabilities via issues
            // For private security advisories, maintainers should check manually

            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'security,vulnerability',
              state: 'open',
              per_page: 100
            });

            const untriaged = issues.filter(issue => {
              const created = new Date(issue.created_at);
              return created < fourteenDaysAgo && issue.comments === 0;
            });

            if (untriaged.length > 0) {
              const list = untriaged.map(i => `- #${i.number}: ${i.title}`).join('\n');

              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: '⚠️ Security Alert: Untriaged Vulnerability Reports (>14 days)',
                body: `The following vulnerability reports need responses (>14 days old):\n\n${list}\n\n/cc @clubanderson @dumb002 @waltforme @ezrasilvera @pdettori\n\nThis violates OpenSSF Best Practices requirements for [vulnerability_report_response].`,
                labels: ['security', 'triage', 'priority']
              });
            }
