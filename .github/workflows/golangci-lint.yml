name: Static Analysis

on:
  schedule:
    - cron: "0 2 * * 1"

  workflow_dispatch:

permissions:
  contents: read
  pull-requests: read

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    name: Lint Go Code
    runs-on: ubuntu-latest
    continue-on-error: true
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
        with:
          fetch-depth: 0

      - uses: actions/setup-go@44694675825211faa026b3c33043df3e48a5fa00
        with:
          go-version-file: go.mod
          cache: true

      - name: Install golangci-lint
        run: |
          curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v2.4.0

      - name: Run golangci-lint
        run: |
          golangci-lint run --timeout=8m --issues-exit-code=0 --config=.golangci.yaml --max-issues-per-linter=50 --max-same-issues=10

      - name: Add Lint Summary
        if: always()
        run: |
          echo "### Static Analysis (Resource-Efficient Mode)" >> $GITHUB_STEP_SUMMARY
          echo "- **Schedule**: Weekly runs (Mondays 2 AM UTC) + manual dispatch only" >> $GITHUB_STEP_SUMMARY
          echo "- **Timeout**: Strict 10-minute limit" >> $GITHUB_STEP_SUMMARY
          echo "- **Mode**: Standard lint with concurrency controls" >> $GITHUB_STEP_SUMMARY
          echo "- **Purpose**: OpenSSF badge compliance visibility" >> $GITHUB_STEP_SUMMARY
          echo "- **Config**: .golangci.yaml" >> $GITHUB_STEP_SUMMARY
          echo "- **Resource Impact**: Minimal overhead - weekly scheduled runs only" >> $GITHUB_STEP_SUMMARY
